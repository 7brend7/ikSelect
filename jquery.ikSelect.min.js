// ikSelect 0.8.6
// Copyright (c) 2012 Igor Kozlov
// i10k.ru
(function(e,t,n,r){function f(t,n){var i=this;i.element=t;i.options=e.extend({},s,n);i._defaults=s;if(i.element===r)return i;i.fakeSelect=e('<div class="ik_select">'+i.options.syntax+"</div>");i.select=e(i.element);i.link=e(".ik_select_link",i.fakeSelect);i.linkText=e(".ik_select_link_text",i.fakeSelect);i.block=e(".ik_select_block",i.fakeSelect);i.list=e(".ik_select_list",i.fakeSelect);i.listInner=e('<div class="ik_select_list_inner"/>');i.active=e([]);i.hover=e([]);i.hoverIndex=-1;i.listItems=e([]);i.init()}var i=e(t),s={syntax:'<div class="ik_select_link"><span class="ik_select_link_text"></span></div><div class="ik_select_block"><div class="ik_select_list"></div></div>',autoWidth:!0,ddFullWidth:!0,customClass:"",ddCustomClass:"",ddMaxHeight:200},o=e([]),u=!1,a=-1;e.browser.mobile=/iphone|ipad|ipod|android/i.test(navigator.userAgent.toLowerCase());e.browser.android=/android/i.test(navigator.userAgent.toLowerCase());e.browser.operamini=Object.prototype.toString.call(t.operamini)==="[object OperaMini]";e.extend(f.prototype,{init:function(){var t=this,n=t.fakeSelect,r=t.select,s=t.link,u=t.block,a=t.list,f=t.listInner;a.append(f);n.addClass(t.options.customClass);u.addClass(t.options.ddCustomClass);t.reset_all();r.attr("disabled")&&t.disable_select();s.bind("click.ikSelect",function(){if(n.data("ik_select_disabled"))return this;o.length&&o.data("plugin_ikSelect").hide_block();e.browser.mobile||t.show_block();r.focus()});r.bind("focus.ikSelect",function(){if(n.data("ik_select_disabled"))return this;s.addClass("ik_select_focus");(n.offset().top+n.height()>i.scrollTop()+i.height()||n.offset().top+n.height()<i.scrollTop())&&i.scrollTop(n.offset().top-i.height()/2)});r.bind("blur.ikSelect",function(){if(n.data("ik_select_disabled"))return this;s.removeClass("ik_select_focus")});r.bind("change.ikSelect",function(){t._select_fake_option()});r.bind("keydown.ikSelect keyup.ikSelect",function(n){var r=t.listItems;t.hoverIndex<0&&(t.hoverIndex=r.index(t.hover));var i=n.which,s=n.type;switch(i){case 40:if(s==="keydown"){n.preventDefault();var o;if(t.hoverIndex<r.length-1){o=r.eq(++t.hoverIndex);while(o&&o.hasClass("ik_select_option_disabled"))o=r.filter(":eq("+ ++t.hoverIndex+")")}o&&t._move_to(o)}break;case 38:if(s==="keydown"){n.preventDefault();var a;if(t.hoverIndex>0){a=r.eq(--t.hoverIndex);while(a&&a.hasClass("ik_select_option_disabled"))a=r.filter(":eq("+ --t.hoverIndex+")")}a&&t._move_to(a)}break;case 33:case 36:if(s==="keydown"){n.preventDefault();t._move_to(r.filter(".not(ik_select_option_disabled):first"))}break;case 34:case 35:if(s==="keydown"){n.preventDefault();t._move_to(r.filter(".not(ik_select_option_disabled):last"))}break;case 32:if(s==="keydown"){n.preventDefault();u.is(":visible")?t._select_real_option():t.show_block()}break;case 13:if(s==="keydown"&&u.is(":visible")){n.preventDefault();t._select_real_option()}break;case 27:if(s==="keydown"){n.preventDefault();t.hide_block()}break;case 9:s==="keydown"&&(e.browser.webkit&&u.is(":visible")?n.preventDefault():t.hide_block());break;default:s==="keyup"&&t._select_fake_option()}});r.after(n);t.redraw();r.appendTo(n)},redraw:function(){var t=this,n=t.select,r=t.fakeSelect,i=t.block,s=t.list,o=t.listInner,u=t.options.autoWidth,f=t.options.ddFullWidth;if(u||f){o.width("auto");e("ul",o).width("auto");r.width("auto");i.show().width(9999);o.css("float","left");s.css("position","absolute");var l=s.outerWidth(!0),c=s.width();s.css("position","static");i.hide().css("width","100%");o.css("float","none");if(a===-1){var h=e('<div style="width:50px; height:50px; overflow:hidden; position:absolute; top:-200px; left:-200px;"><div style="height:100px;"></div>');e("body").append(h);var p=e("div",h).innerWidth();h.css("overflow","auto");var d=e("div",h).innerWidth();e(h).remove();a=p-d}var v=r.parent().width();if(f){i.width(l);o.width(c);e("ul",o).width(c)}l>v&&(l=v);u&&r.width(l)}t._fix_height();n.css({position:"absolute",margin:0,padding:0,left:-9999,top:0});e.browser.android&&n.css({opacity:0,left:0,height:r.height()})},reset_all:function(){var t=this,n=t.select,r=t.linkText,i=t.listInner;r.html(n.html());i.empty();var s="";s+="<ul>";n.children().each(function(){if(this.tagName==="OPTGROUP"){var t=e(this);s+='<li class="ik_select_optgroup'+(t.is(":disabled")?" ik_select_optgroup_disabled":"")+'">';s+='<div class="ik_select_optgroup_label">'+t.attr("label")+"</div>";s+="<ul>";e("option",t).each(function(){var t=e(this);s+="<li"+(t.is(":disabled")?' class="ik_select_option_disabled"':"")+'><span class="ik_select_option" title="'+t.val()+'">'+t.html()+"</span></li>"});s+="</ul>";s+="</li>"}else{var n=e(this);s+="<li"+(n.is(":disabled")?' class="ik_select_option_disabled"':"")+'><span class="ik_select_option" title="'+n.val()+'">'+n.html()+"</span></li>"}});s+="</ul>";i.append(s);t._select_fake_option();t.listItems=e("li:not(.ik_select_optgroup)",i);t._attach_list_events(t.listItems)},_attach_list_events:function(t){var n=this,r=n.select,i=n.linkText,s=t.not(".ik_select_option_disabled");s.bind("click.ikSelect",function(){i.html(e(".ik_select_option",this).html());r.val(e(".ik_select_option",this).attr("title"));n.active.removeClass("ik_select_active");n.active=e(this).addClass("ik_select_active");n.hide_block();r.change();r.focus()});s.bind("mouseover.ikSelect",function(){n.hoverIndex=-1;n.hover.removeClass("ik_select_hover");n.hover=e(this).addClass("ik_select_hover")});s.addClass("ik_select_has_events")},_detach_list_events:function(e){e.unbind(".ikSelect");e.removeClass("ik_select_has_events")},set_defaults:function(t){e.extend(this._defaults,t||{});return this},hide_block:function(){var t=this.fakeSelect,n=this.block,r=this.select;n.hide().appendTo(t).css({left:"",top:""});o=e([]);r.focus()},show_block:function(){var t=this,n=t.select;if(e.browser.mobile&&!e.browser.android){n.focus();return t}if(o.is(t.select))return t;o.length&&o.data("plugin_ikSelect").hide_block();var r=t.fakeSelect,s=t.block,u=t.list,a=t.listInner,f=t.hover,l=t.active,c=t.listItems;s.show();var h=e("option",n).index(e("option:selected",n));f.removeClass("ik_select_hover");l.removeClass("ik_select_active");var p=c.eq(h);p.addClass("ik_select_hover ik_select_active");t.hover=p;t.active=p;t.hoverIndex=t.listItems.index(p);s.removeClass("ik_select_block_right");s.css("left","");if(t.options.ddFullWidth&&r.offset().left+s.outerWidth(!0)>i.width()){s.addClass("ik_select_block_right");s.css("left",(s.offset().left+s.outerWidth(!0)-i.width())*-1)}s.removeClass("ik_select_block_up");s.css("top","");if(s.offset().top+s.outerHeight(!0)>i.scrollTop()+i.height()){s.addClass("ik_select_block_up");s.css("top",(s.offset().top+s.outerHeight(!0)-parseInt(s.css("top"),10)-(i.scrollTop()+i.height()))*-1)}var d=s.offset().left;d<0&&(d=0);var v=s.offset().top;s.width(s.width());s.appendTo("body").css({left:d,top:v});var m=e(".ik_select_active",u).position().top-u.height()/2;u.data("ik_select_scrollTop",m);a.scrollTop(m);o=n},add_options:function(t){var n=this,r=n.select,i=n.listInner,s="",o="";e.each(t,function(t,n){if(typeof n=="string"){s+='<li><span class="ik_select_option" title="'+t+'">'+n+"</span></li>";o+='<option value="'+t+'">'+n+"</option>"}else if(typeof n=="object"){var u=e("> ul > li.ik_select_optgroup:eq("+t+") > ul",i),a=e("optgroup:eq("+t+")",r),f=n;e.each(f,function(e,t){s+='<li><span class="ik_select_option" title="'+e+'">'+t+"</span></li>";o+='<option value="'+e+'">'+t+"</option>"});u.append(s);a.append(o);s="";o=""}});if(o!==""){e(":first",i).append(s);r.append(o)}n._fix_height();n.listItems=e("li:not(.ik_select_optgroup)",i);n._attach_list_events(n.listItems)},remove_options:function(t){var n=this,r=n.select,i=n.listItems,s=e([]);e.each(t,function(t,n){e("option",r).each(function(t){e(this).val()===n&&(s=s.add(e(this)).add(i.eq(t)))})});n.listItems=i.not(s);s.remove();n._select_fake_option();n._fix_height()},_select_real_option:function(){var e=this.hover,t=this.active;t.removeClass("ik_select_active");e.addClass("ik_select_active").click()},_select_fake_option:function(){var t=this,n=t.select,r=t.linkText,i=t.listItems,s=e(":selected",n),o=e("option",n).index(s);r.html(s.html());t.hover=i.removeClass("ik_select_hover ik_select_active").eq(o).addClass("ik_select_hover ik_select_active");t.active=t.hover},disable_select:function(){var e=this.fakeSelect,t=this.select;t.attr("disabled","disabled");e.addClass("ik_select_disabled").data("ik_select_disabled",!0)},enable_select:function(){var e=this.fakeSelect,t=this.select;t.removeAttr("disabled");e.removeClass("ik_select_disabled").data("ik_select_disabled",!1)},toggle_select:function(){var e=this,t=e.fakeSelect;t.data("ik_select_disabled")?e.enable_select():e.disable_select()},make_selection:function(e){var t=this,n=t.select;n.val(e);t._select_fake_option()},disable_optgroups:function(t){var n=this,r=n.select,i=n.list;e.each(t,function(t,s){var o=e("optgroup:eq("+s+")",r);o.attr("disabled","disabled");e(".ik_select_optgroup:eq("+s+")",i).addClass("ik_select_optgroup_disabled");n.disable_options(e("option",o))});n._select_fake_option()},enable_optgroups:function(t){var n=this,r=n.select,i=n.list;e.each(t,function(t,s){var o=e("optgroup:eq("+s+")",r);o.removeAttr("disabled");e(".ik_select_optgroup:eq("+s+")",i).removeClass("ik_select_optgroup_disabled");n.enable_options(e("option",o))});n._select_fake_option()},disable_options:function(t){var n=this,r=n.select,i=n.listItems,s=e("option",r);e.each(t,function(t,r){if(typeof r=="object"){e(this).attr("disabled","disabled");var o=s.index(this),u=i.eq(o).addClass("ik_select_option_disabled");n._detach_list_events(u)}else s.each(function(t){if(e(this).val()===r){e(this).attr("disabled","disabled");var s=i.eq(t).addClass("ik_select_option_disabled");n._detach_list_events(s);return this}})});n._select_fake_option()},enable_options:function(t){var n=this,r=n.select,i=n.listItems,s=e("option",r);e.each(t,function(t,r){if(typeof r=="object"){e(this).removeAttr("disabled");var o=s.index(this),u=i.eq(o).removeClass("ik_select_option_disabled");n._attach_list_events(u)}else s.each(function(t){if(e(this).val()===r){e(this).removeAttr("disabled");var s=i.eq(t).removeClass("ik_select_option_disabled");n._attach_list_events(s);return this}})});n._select_fake_option()},detach_plugin:function(){var e=this,t=e.select,n=e.fakeSelect;t.unbind(".ikSelect").css({width:"",height:"",left:"",top:"",position:"",margin:"",padding:""});n.before(t);n.remove()},_move_to:function(t){var n=this,r=n.select,i=n.linkText,s=n.block,o=n.list,u=n.listInner;if(!s.is(":visible")&&e.browser.webkit){n.show_block();return this}n.hover.removeClass("ik_select_hover");t.addClass("ik_select_hover");n.hover=t;if(!e.browser.webkit){n.active.removeClass("ik_select_active");t.addClass("ik_select_active");n.active=t}if(!s.is(":visible")||e.browser.mozilla){if(!e.browser.mozilla){r.val(e(".ik_select_option",t).attr("title"));r.change()}i.html(e(".ik_select_option",t).html())}var a=t.offset().top-o.offset().top-parseInt(o.css("paddingTop"),10),f=a+t.outerHeight();f>o.height()?u.scrollTop(u.scrollTop()+f-o.height()):a<0&&u.scrollTop(u.scrollTop()+a)},_fix_height:function(){var t=this,n=t.block,r=t.listInner,i=t.options.ddMaxHeight,s=t.options.ddFullWidth;n.show();r.css("height","auto");if(r.height()>i){r.css({overflow:"auto",height:i,position:"relative"});if(!e.data(r,"ik_select_hasScrollbar")&&s){n.width(n.width()+a);r.width(r.width()+a)}e.data(r,"ik_select_hasScrollbar",!0)}else if(e.data(r,"ik_select_hasScrollbar")){r.css({overflow:"",height:"auto"});r.width(r.width()-a);n.width(n.width()-a)}n.hide()}});e.fn.ikSelect=function(t){if(e.browser.operamini)return this;var n=Array.prototype.slice.call(arguments);return this.each(function(){if(!e.data(this,"plugin_ikSelect"))e.data(this,"plugin_ikSelect",new f(this,t));else if(typeof t=="string"){var r=e.data(this,"plugin_ikSelect");switch(t){case"reset":r.reset_all();break;case"hide_dropdown":r.hide_block();break;case"show_dropdown":u=!0;r.select.focus();r.show_block();break;case"add_options":r.add_options(n[1]);break;case"remove_options":r.remove_options(n[1]);break;case"enable":r.enable_select();break;case"disable":r.disable_select();break;case"toggle":r.toggle_select();break;case"select":r.make_selection(n[1]);break;case"set_defaults":r.set_defaults(n[1]);break;case"redraw":r.redraw();break;case"disable_options":r.disable_options(n[1]);break;case"enable_options":r.enable_options(n[1]);break;case"disable_optgroups":r.disable_optgroups(n[1]);break;case"enable_optgroups":r.enable_optgroups(n[1]);break;case"detach":r.detach_plugin()}}})};e.ikSelect=new f;e(n).bind("click.ikSelect",function(t){if(!u&&o.length&&!e(t.target).parents(".ik_select").length){o.ikSelect("hide_dropdown");o=e([])}u&&(u=!1)})})(jQuery,window,document);