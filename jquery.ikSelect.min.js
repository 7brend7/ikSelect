// ikSelect 0.7.1
// Copyright (c) 2012 Igor Kozlov
// i10k.ru

;(function($,x,y,z){var A=$(x);var B={syntax:'<div class="ik_select_link"><span class="ik_select_link_text"></span></div><div class="ik_select_block"><div class="ik_select_list"></div></div>',autoWidth:true,ddFullWidth:true,customClass:"",ddCustomClass:"",ddMaxHeight:200};var C=$([]);var D=false;var E=-1;$.browser.mobile=(/iphone|ipad|ipod|android/i.test(navigator.userAgent.toLowerCase()));$.browser.android=(/android/i.test(navigator.userAgent.toLowerCase()));$.browser.operamini=Object.prototype.toString.call(x.operamini)==="[object OperaMini]";function IkSelect(a,b){var c=this;c.element=a;c.options=$.extend({},B,b);c._defaults=B;c._name='ikSelect';if(c.element===z){return c}c.fakeSelect=$('<div class="ik_select">'+c.options.syntax+'</div>');c.select=$(c.element);c.link=$(".ik_select_link",c.fakeSelect);c.linkText=$(".ik_select_link_text",c.fakeSelect);c.block=$(".ik_select_block",c.fakeSelect);c.list=$(".ik_select_list",c.fakeSelect);c.listInner=$('<div class="ik_select_list_inner"/>');c.active=$([]);c.hover=$([]);c.init()}$.extend(IkSelect.prototype,{init:function(){var h=this;var i=h.options.autoWidth;var j=h.options.ddFullWidth;var k=h.fakeSelect;var l=h.select;var m=h.link;var n=h.linkText;var o=h.block;var p=h.list;var q=h.listInner;p.append(q);k.addClass(h.options.customClass);o.addClass(h.options.ddCustomClass);h.reset();if(l.attr("disabled")){h.disable_select()}m.bind("click.ikSelect",function(){if(k.data("ik_select_disabled")){return this}if(C.length){C.data("plugin_ikSelect").hide_block()}if(!$.browser.mobile){h.show_block()}l.focus()});l.bind("focus.ikSelect",function(){if(k.data("ik_select_disabled")){return this}m.addClass("ik_select_focus");if((k.offset().top+k.height()>A.scrollTop()+A.height())||(k.offset().top+k.height()<A.scrollTop())){A.scrollTop(k.offset().top-A.height()/2)}});l.bind("blur.ikSelect",function(){if(k.data("ik_select_disabled")){return this}m.removeClass("ik_select_focus")});l.bind("change.ikSelect",function(a){h._select_fake_option()});l.bind("keydown.ikSelect keyup.ikSelect",function(a){var b=a.which;var c=h.active;var d=h.hover;var e=a.type;switch(b){case 40:if(e==="keydown"){a.preventDefault();var f;if(d.next("li").length){f=d.next("li")}else if(d.parents(".ik_select_optgroup").next().length){f=d.parents(".ik_select_optgroup").next().find("li:first")}if(f&&f.length){h._move_to(f)}}break;case 38:if(e==="keydown"){a.preventDefault();var g;if(d.prev("li").length){g=d.prev("li")}else if(d.parents(".ik_select_optgroup").prev().length){g=d.parents(".ik_select_optgroup").prev().find("li:last")}if(g&&g.length){h._move_to(g)}}break;case 33:case 36:if(e==="keydown"){a.preventDefault();h._move_to($("li:first",p))}break;case 34:case 35:if(e==="keydown"){a.preventDefault();h._move_to($("li:last",p))}break;case 32:if(e==="keydown"){a.preventDefault();if(!o.is(":visible")){h.show_block()}else{h._select_real_option()}}break;case 13:if(e==="keydown"&&o.is(":visible")){a.preventDefault();h._select_real_option()}break;case 27:if(e==="keydown"){a.preventDefault();h.hide_block()}break;case 9:if(e==="keydown"){if($.browser.webkit&&o.is(":visible")){a.preventDefault()}else{h.hide_block()}}break;default:if(e==="keyup"){h._select_fake_option()}break}});l.after(k);if(i||j){o.show().width(9999);q.css("float","left");p.css("position","absolute");var r=p.outerWidth(true);var s=p.width();p.css("position","static");o.hide().css("width","100%");q.css("float","none");if(E===-1){var t=$('<div style="width:50px;height:50px;overflow:hidden;position:absolute;top:-200px;left:-200px;"><div style="height:100px;"></div>');$("body").append(t);var u=$('div',t).innerWidth();t.css('overflow-y','scroll');var v=$('div',t).innerWidth();$(t).remove();E=u-v}var w=l.parent().width();if(j){o.width(r);q.width(s);$("ul",q).width(s)}if(r>w){r=w}if(i){k.width(r)}}h._fix_height();if(!$.browser.mobile){l.width(1);l.css({left:-9999,top:0,height:k.height()})}l.prependTo(k);o.data("ik_select_block_left",o.css("left"));o.data("ik_select_block_top",o.css("top"))},reset:function(){var a=this;var b=a.select;var c=a.linkText;var d=a.listInner;c.html(b.html());d.empty();var e='';var f=$("optgroup",b);if(f.length){f.each(function(){e+='<div class="ik_select_optgroup">';e+='<div class="ik_select_optgroup_label">'+$(this).attr("label")+'</div>';e+='<ul>';$("option",this).each(function(){e+='<li><span class="ik_select_option" title="'+$(this).val()+'">'+$(this).html()+'</span></li>'});e+='</ul>';e+='</div>'})}else{e+='<ul>';$("option",b).each(function(){e+='<li><span class="ik_select_option" title="'+$(this).val()+'">'+$(this).html()+'</span></li>'});e+='</ul>'}d.append(e);a._select_fake_option();a._attach_list_events($("li",d))},_attach_list_events:function(a){var b=this;var c=b.select;var d=b.linkText;var e=b.list;a.bind("click.ikSelect",function(){d.html($(".ik_select_option",this).html());c.val($(".ik_select_option",this).attr("title"));b.active.removeClass("ik_select_active");b.active=$(this).addClass("ik_select_active");b.hide_block();c.change();c.focus()});a.bind("mouseover.ikSelect",function(){b.hover.removeClass("ik_select_hover");b.hover=$(this).addClass("ik_select_hover")});a.addClass("ik_select_has_events")},set_defaults:function(a){$.extend(this._defaults,a||{});return this},hide_block:function(){var a=this.fakeSelect;var b=this.block;var c=this.select;b.hide().appendTo(a).css({"left":b.data("ik_select_block_left"),"top":b.data("ik_select_block_top")});C=$([]);c.focus()},show_block:function(){var a=this;var b=a.select;if($.browser.mobile&&!$.browser.android){b.focus();return a}var c=a.fakeSelect;var d=a.block;var e=a.list;var f=a.listInner;var g=a.hover;var h=a.active;d.show();var i=$("option",b).index($("option:selected",b));g.removeClass("ik_select_hover");h.removeClass("ik_select_active");var j=$("li:eq("+i+")",e);j.addClass("ik_select_hover ik_select_active");a.hover=j;a.active=j;d.removeClass("ik_select_block_right");d.css("left",d.data("ik_select_block_left"));if(a.options.ddFullWidth&&c.offset().left+d.outerWidth(true)>A.width()){d.addClass("ik_select_block_right");d.css("left",(d.offset().left+d.outerWidth(true)-A.width())*(-1))}d.removeClass("ik_select_block_up");d.css("top",d.data("ik_select_block_top"));if(d.offset().top+d.outerHeight(true)>A.scrollTop()+A.height()){d.addClass("ik_select_block_up");d.css("top",((d.offset().top+d.outerHeight(true)-parseInt(d.data("ik_select_block_top"),10))-(A.scrollTop()+A.height()))*(-1))}var k=d.offset().left;var l=d.offset().top;d.width(d.width());d.appendTo("body").css({"left":k,"top":l});var m=$(".ik_select_active",e).position().top-e.height()/2;e.data("ik_select_scrollTop",m);f.scrollTop(m);C=b},add_options:function(h){var i=this;var j=i.select;var k=i.list;var l=i.listInner;var m='',selectHtml='';$.each(h,function(c,d){if(typeof d==='string'){m+='<li><span class="ik_select_option" title="'+c+'">'+d+'</span></li>';selectHtml+='<option value="'+c+'">'+d+'</option>'}else if(typeof d==='object'){var e=$("ul:eq("+c+")",k);var f=$("optgroup:eq("+c+")",j);var g=d;$.each(g,function(a,b){m+='<li><span class="ik_select_option" title="'+a+'">'+b+'</span></li>';selectHtml+='<option value="'+a+'">'+b+'</option>'});e.append(m);f.append(selectHtml);m='';selectHtml=''}});if(selectHtml!==''){$(":first",l).append(m);j.append(selectHtml)}i._fix_height();i._attach_list_events($("li:not(.ik_select_has_events)",l))},remove_options:function(d){var e=this;var f=e.select;var g=e.list;var h=$([]);$.each(d,function(b,c){$("option",f).each(function(a){if($(this).val()===c){h=h.add($(this)).add($("li:eq("+a+")",g))}})});h.remove();e._select_fake_option();e._fix_height()},_select_real_option:function(){var a=this.hover;var b=this.active;b.removeClass("ik_select_active");a.addClass("ik_select_active").click()},_select_fake_option:function(){var a=this;var b=a.select;var c=a.list;var d=a.linkText;var e=$(":selected",b);var f=$("option",b).index(e);d.html(e.html());a.hover=$("li",c).removeClass("ik_select_hover ik_select_active").eq(f).addClass("ik_select_hover ik_select_active");a.active=a.hover},disable_select:function(){var a=this.fakeSelect;var b=this.select;b.attr("disabled","disabled");a.addClass("ik_select_disabled").data("ik_select_disabled",true)},enable_select:function(){var a=this.fakeSelect;var b=this.select;b.removeAttr("disabled");a.removeClass("ik_select_disabled").data("ik_select_disabled",false)},toggle_select:function(){var a=this;var b=a.fakeSelect;if(b.data("ik_select_disabled")){a.enable_select()}else{a.disable_select()}},make_selection:function(a){var b=this;var c=b.select;c.val(a);b._select_fake_option()},_move_to:function(a){var b=this;var c=b.select;var d=b.block;var e=b.linkText;if(!d.is(":visible")&&$.browser.webkit){b.show_block();return this}b.hover.removeClass("ik_select_hover");a.addClass("ik_select_hover");b.hover=a;if(!$.browser.webkit){b.active.removeClass("ik_select_active");a.addClass("ik_select_active");b.active=a}if(!d.is(":visible")||$.browser.mozilla){if(!$.browser.mozilla){c.val($(".ik_select_option",a).attr("title"));c.change()}e.html($(".ik_select_option",a).html())}},_fix_height:function(){var a=this;var b=a.block;var c=a.listInner;var d=a.options.ddMaxHeight;var e=a.options.ddFullWidth;b.show();c.css("height","auto");if(c.height()>d){c.css({overflow:"auto",height:d,position:"relative"});if(!$.data(c,"ik_select_hasScrollbar")){if(e){b.width(b.width()+E);c.width(c.width()+E)}}$.data(c,"ik_select_hasScrollbar",true)}else{if($.data(c,"ik_select_hasScrollbar")){c.css({overflow:"",height:"auto"});c.width(c.width()-E);b.width(b.width()-E)}}b.hide()}});$.fn.ikSelect=function(b){if($.browser.operamini){return this}var c=Array.prototype.slice.call(arguments);return this.each(function(){if(!$.data(this,'plugin_ikSelect')){$.data(this,'plugin_ikSelect',new IkSelect(this,b))}else if(typeof b==='string'){var a=$.data(this,'plugin_ikSelect');switch(b){case'reset':a.reset();break;case'hide_dropdown':a.hide_block();break;case'show_dropdown':a.show_block();D=true;break;case'add_options':a.add_options(c[1]);break;case'remove_options':a.remove_options(c[1]);break;case'enable':a.enable_select();break;case'disable':a.disable_select();break;case'toggle':a.toggle_select();break;case'select':a.make_selection(c[1]);break;case'set_defaults':a.set_defaults(c[1]);break}}})};$.ikSelect=new IkSelect();$(y).bind("click.ikSelect",function(a){if(!D&&C.length&&!$(a.target).parents(".ik_select").length){C.ikSelect("hide_dropdown");C=$([])}if(D){D=false}})})(jQuery,window,document);